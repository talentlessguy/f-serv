"use strict";function _interopDefault(n){return n&&"object"==typeof n&&"default"in n?n.default:n}var http=require("http"),fs=require("fs"),marked=_interopDefault(require("marked")),open=_interopDefault(require("open"));const reset="[0m",blue=n=>`[34m${n}[0m`,cyan=n=>`[36m${n}[0m`,bold=n=>`[1m${n}[0m`;var addClass=n=>{const e=fs.lstatSync(n);let t="";return e.isFile()?(n=>{const e=n.slice(n.lastIndexOf(".")+1,n.length);/(package.json|yarn.lock|Pipfile(\.lock)?)/.test(n)?t+=n.slice(n.lastIndexOf("/")+1,n.length).replace(/\./g,"_"):t+=e})(n):t+="dir",t},cleanHtml=n=>n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),template=n=>`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>f-serv</title>\n  <style>\n  button {\n    height: 2em;\n    border: none;\n    background: inherit;\n    font-size: 1.2em;\n    margin: .3em\n  }\n  button:hover {\n    cursor: pointer;\n    filter: brightness(90%)\n  }\n     \n  body {\n    display: flex;\n    flex-direction: column;\n    background: white;\n    margin: 0;\n    justify-content: center;\n    align-items: center;\n    font-family: sans-serif;\n    flex-wrap: wrap;\n  }\n  \n  h1 {\n    font-size: 3vw;\n    padding-top: 1em;\n    margin-bottom: 0\n  }\n  \n  body div {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: inherit;\n    width: 60vw;\n  }\n  \n  a {\n    font-size: 1.4em;\n    text-decoration: underline;\n    color: blue;\n    cursor: pointer\n  }\n  \n  main {\n    padding: 1em;\n  }\n  \n  pre, code {\n    font-family: 'Fira Code', Consolas, monospace;\n  }\n  \n  pre {\n    padding: 0.5em;\n    background: whitesmoke;\n    width: \n  }\n  \n  .js {\n    background: #e5e22f\n  }\n  \n  .yarn_lock, .yarn-integrity {\n    background: #2c8ebb;\n    color: white\n  }\n  \n  .md, .package_json {\n    background: #e52f35;\n    color: white\n  }\n  \n  .html, .rb {\n    background: red;\n    color: white\n  }\n  \n  .gitignore {\n    background: #f74e27;\n    color: white\n  }\n  \n  .dir {\n    border: 1px solid black\n  }\n  \n  .py, .python-version, .Pipfile, .Pipfile_lock {\n    background: #264d6f;\n    color: white\n  }\n  </style>\n</head>\n<body>\n  ${n}\n  <span>by <a href="https://github.com/talentlessguy">v1rtl</a></span>\n</body>\n</html>\n`;const{chdir:chdir,cwd:cwd}=process,{readdir:readdir,readFile:readFile,lstat:lstat}=fs.promises,fServ=(n=80,e="./",t=!1)=>{http.createServer(async(n,t)=>{if(n.url=decodeURI(n.url),"/"===n.url){chdir(e);try{const n=await readdir("./");t.end(template(`\n        \n        <body style="height: 100vh" >\n        <h1>üìÅ ${cwd().toString().slice(cwd().lastIndexOf("/")+1,cwd().length)}\n        </h1>\n        <h4>${cwd()}</h4>\n        <div>\n        ${n.map(n=>`<button\n              class="${addClass(n)}"\n              onClick="location.href = this.innerText"\n            >\n            ${n}\n            </button>\n            `).join("")}</div></body>`))}catch(n){t.end(template(`\n        <h1>Oops! ‚ö† </h1>\n        <h2>${n}</h2>\n        `))}}else if("/favicon.ico"===n.url)t.end("");else{let e=n.url.slice(1,n.url.length);const i=!(await lstat(e)).isDirectory()&&fs.existsSync(e),r=i?await readFile(e):await readdir(e),a=cleanHtml(r.toString());t.end(template(`\n\t\t\t<h1>${i?"üìú":"üìÅ"} ${e.slice(e.lastIndexOf("/")+1,e.length)}</h1>\n\t\t\t<a onClick="history.back()">back</a>\n      <a href="/">home</a>\n\t\t${i?e.includes(".md")?`<main>${marked(a)}</main>`:`<pre>${a}</pre>`:"<div>"+r.map(n=>`<button onClick="location.href = location.href + '/' + this.innerText"\n\t\t\t\t\t\tclass=${addClass(e+"/"+n)}>\n\t\t\t\t\t\t\t${n}</button>`).join("")+"</div>"}`))}}).listen(n,async()=>{console.log(cyan("\nf-serv is starting from:"),blue(`\n\n${e||__dirname}`),cyan("\n\nApp is served on"),bold(`http://localhost:${n}`),cyan("\n\nQuit f-serv: Ctrl + C")),t&&await open(`http://localhost:${n}`)})};module.exports=fServ;
