"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var Koa=_interopDefault(require("koa")),fs=require("fs"),marked=_interopDefault(require("marked")),chalk=require("chalk"),open=_interopDefault(require("open")),globalStyles=()=>"\nbutton {\n\theight: 2em;\n\tborder: none;\n\tbackground: inherit;\n\tfont-size: 1.2em;\n\tmargin: .3em\n}\nbutton:hover {\n\tcursor: pointer;\n\tfilter: brightness(90%)\n}\n   \nbody {\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: white;\n\tmargin: 0;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: sans-serif;\n\tflex-wrap: wrap\n}\n\nh1 {\n\tfont-size: 3vw;\n\tpadding-top: 1em;\n\tmargin-bottom: 0\n}\n\nbody div {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: inherit;\n\twidth: 60vw;\n}\n\na {\n\tfont-size: 1.4em;\n\ttext-decoration: underline;\n\tcolor: blue;\n\tcursor: pointer\n}\n\nmain {\n\tpadding: 1em;\n}\n\npre, code {\n\tfont-family: 'Fira Code', Consolas, monospace;\n}\n\npre {\n\tpadding: 0.5em;\n\tbackground: whitesmoke\n}\n\n.js {\n\tbackground: #e5e22f\n}\n\n.yarn_lock, .yarn-integrity {\n\tbackground: #2c8ebb;\n\tcolor: white\n}\n\n.md, .package_json {\n\tbackground: #e52f35;\n\tcolor: white\n}\n\n.html, .rb {\n\tbackground: red;\n\tcolor: white\n}\n\n.gitignore {\n\tbackground: #f74e27;\n\tcolor: white\n}\n\n.dir {\n\tborder: 1px solid black\n}\n\n.py, .python-version, .Pipfile, .Pipfile_lock {\n\tbackground: #264d6f;\n\tcolor: white\n}\n",addClass=t=>{const n=fs.lstatSync(t);let e="";return n.isFile()?(t=>{const n=t.slice(t.lastIndexOf(".")+1,t.length);/(package.json|yarn.lock|Pipfile(\.lock)?)/.test(t)?e+=t.slice(t.lastIndexOf("/")+1,t.length).replace(/\./g,"_"):e+=n})(t):e+="dir",e},cleanHtml=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");const{chdir:chdir,cwd:cwd}=process,{readdir:readdir,readFile:readFile,lstat:lstat}=fs.promises,fServ=(t=80,n="./")=>{const e=new Koa;e.use(async t=>{if(t.url=decodeURI(t.url),"/"===t.url){chdir(n);const e=await readdir("./");t.body=`\n\t\t\t<style>\n\t\t\t${globalStyles()}\n\t\t\t</style>\n\t\t\t<body style="height: 100vh" >\n\t\t\t<h1>üóÇÔ∏è ${cwd().toString().slice(cwd().lastIndexOf("/")+1,cwd().length)}\n\t\t\t</h1>\n\t\t\t<h4>${cwd()}</h4>\n\t\t\t<div>\n\t\t\t${e.map(t=>`<button\n\t\t\t\t\t\tclass="${addClass(t)}"\n\t\t\t\t\t\tonClick="location.href = this.innerText"\n\t\t\t\t\t>\n\t\t\t\t\t${t}\n\t\t\t\t\t</button>\n\t\t\t\t\t`).join("")}</div></body>`}else{let n=t.url;n=t.url.slice(1,n.length);const e=!(await lstat(n)).isDirectory()&&fs.existsSync(n),r=e?await readFile(n):await readdir(n);t.type="html";const o=cleanHtml(r.toString());t.body=`<style>\n\t\t\t${globalStyles()}\n\t\t\t</style>\n\t\t\t<body>\n\t\t\t<h1>${e?"üìú":"üìÅ"} ${n.slice(n.lastIndexOf("/")+1,n.length)}</h1>\n\t\t\t<a onClick="history.back()">back</a>\n\t\t\t<a href="/">home</a>\n\t\t${e?n.includes(".md")?`<main>${marked(o)}</main>`:`<pre>${o}</pre>`:"<div>"+r.map(t=>`<button onClick="location.href = location.href + '/' + this.innerText"\n\t\t\t\t\t\tclass=${addClass(n+"/"+t)}>\n\t\t\t\t\t\t\t${t}</button>`).join("")+"</div>"}</body>`}}),e.listen(t,async()=>{console.log(chalk.cyan("\nf-serv is starting from:"),chalk.blue(`\n\n${n||__dirname}`),chalk.cyan("\n\nApp is served on"),chalk.bold(`http://localhost:${t}`),chalk.cyan("\n\nQuit f-serv: Ctrl + C")),await open(`http://localhost:${t}`)})};module.exports=fServ,!module.parent&&fServ(process.argv[2],process.argv[3]);
