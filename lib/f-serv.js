"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var http=require("http"),fs=require("fs"),marked=_interopDefault(require("marked")),chalk=require("chalk"),open=_interopDefault(require("open")),globalStyles=()=>"\nbutton {\n\theight: 2em;\n\tborder: none;\n\tbackground: inherit;\n\tfont-size: 1.2em;\n\tmargin: .3em\n}\nbutton:hover {\n\tcursor: pointer;\n\tfilter: brightness(90%)\n}\n   \nbody {\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: white;\n\tmargin: 0;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: sans-serif;\n\tflex-wrap: wrap\n}\n\nh1 {\n\tfont-size: 3vw;\n\tpadding-top: 1em;\n\tmargin-bottom: 0\n}\n\nbody div {\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: inherit;\n\twidth: 60vw;\n}\n\na {\n\tfont-size: 1.4em;\n\ttext-decoration: underline;\n\tcolor: blue;\n\tcursor: pointer\n}\n\nmain {\n\tpadding: 1em;\n}\n\npre, code {\n\tfont-family: 'Fira Code', Consolas, monospace;\n}\n\npre {\n\tpadding: 0.5em;\n  background: whitesmoke;\n  width: \n}\n\n.js {\n\tbackground: #e5e22f\n}\n\n.yarn_lock, .yarn-integrity {\n\tbackground: #2c8ebb;\n\tcolor: white\n}\n\n.md, .package_json {\n\tbackground: #e52f35;\n\tcolor: white\n}\n\n.html, .rb {\n\tbackground: red;\n\tcolor: white\n}\n\n.gitignore {\n\tbackground: #f74e27;\n\tcolor: white\n}\n\n.dir {\n\tborder: 1px solid black\n}\n\n.py, .python-version, .Pipfile, .Pipfile_lock {\n\tbackground: #264d6f;\n\tcolor: white\n}\n",addClass=t=>{const n=fs.lstatSync(t);let e="";return n.isFile()?(t=>{const n=t.slice(t.lastIndexOf(".")+1,t.length);/(package.json|yarn.lock|Pipfile(\.lock)?)/.test(t)?e+=t.slice(t.lastIndexOf("/")+1,t.length).replace(/\./g,"_"):e+=n})(t):e+="dir",e},cleanHtml=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),template=t=>`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>f-serv</title>\n</head>\n<body>\n  ${t}\n  <span>by <a href="https://github.com/talentlessguy">v1rtl</a></span>\n</body>\n</html>\n`;const{chdir:chdir,cwd:cwd}=process,{readdir:readdir,readFile:readFile,lstat:lstat}=fs.promises,fServ=(t=80,n="./",e=!1)=>{http.createServer(async(t,e)=>{if(t.url=decodeURI(t.url),"/"===t.url){chdir(n);const t=await readdir("./");e.end(template(`\n\t\t\t<style>\n\t\t\t${globalStyles()}\n\t\t\t</style>\n\t\t\t<body style="height: 100vh" >\n\t\t\t<h1>üìÅ ${cwd().toString().slice(cwd().lastIndexOf("/")+1,cwd().length)}\n\t\t\t</h1>\n\t\t\t<h4>${cwd()}</h4>\n\t\t\t<div>\n\t\t\t${t.map(t=>`<button\n\t\t\t\t\t\tclass="${addClass(t)}"\n\t\t\t\t\t\tonClick="location.href = this.innerText"\n\t\t\t\t\t>\n\t\t\t\t\t${t}\n\t\t\t\t\t</button>\n\t\t\t\t\t`).join("")}</div></body>`))}else if("/favicon.ico"===t.url)e.end("");else{let n=t.url.slice(1,t.url.length);const a=!(await lstat(n)).isDirectory()&&fs.existsSync(n),i=a?await readFile(n):await readdir(n),l=cleanHtml(i.toString());e.end(template(`<style>\n\t\t\t${globalStyles()}\n\t\t\t</style>\n\t\t\t<body>\n\t\t\t<h1>${a?"üìú":"üìÅ"} ${n.slice(n.lastIndexOf("/")+1,n.length)}</h1>\n\t\t\t<a onClick="history.back()">back</a>\n      <a href="/">home</a>\n\t\t${a?n.includes(".md")?`<main>${marked(l)}</main>`:`<pre>${l}</pre>`:"<div>"+i.map(t=>`<button onClick="location.href = location.href + '/' + this.innerText"\n\t\t\t\t\t\tclass=${addClass(n+"/"+t)}>\n\t\t\t\t\t\t\t${t}</button>`).join("")+"</div>"}</body>`))}}).listen(t,async()=>{console.log(chalk.cyan("\nf-serv is starting from:"),chalk.blue(`\n\n${n||__dirname}`),chalk.cyan("\n\nApp is served on"),chalk.bold(`http://localhost:${t}`),chalk.cyan("\n\nQuit f-serv: Ctrl + C")),e&&await open(`http://localhost:${t}`)})};module.exports=fServ;
